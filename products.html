<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warehouse Terminator Deals ‚Äî Hot Deals</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b0c10; --card:#1a1a1d; --text:#e9eef5; --muted:#a8b3c7; --accent:#00ff88;
    --btn:#223246; --btn2:#1877f2; --btn3:#232f3e; --border:#273042;
  }
  [data-theme="light"]{
    --bg:#f7f9fc; --card:#ffffff; --text:#0b0c10; --muted:#42536a; --accent:#0fbf6b;
    --btn:#e6eef8; --btn2:#1877f2; --btn3:#232f3e; --border:#e6eef8;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{display:flex;flex-wrap:wrap;align-items:center;gap:12px;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--border)}
  .brand{display:flex;align-items:center;gap:10px}
  .brand h1{font-size:18px;margin:0;color:var(--accent);font-weight:800}
  .tools{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .switch,select,input{background:var(--card);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px 12px}
  input[type="search"]{min-width:220px}
  .switch{cursor:pointer}
  .wrap{max-width:1200px;margin:0 auto;padding:16px}
  .filters{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
  @media (max-width:1100px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media (max-width:800px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:520px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
  .media{position:relative;background:#0b1117}
  .media img{width:100%;height:220px;object-fit:cover;display:block}
  .navbtn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.2);color:#fff;border-radius:10px;padding:6px 8px;cursor:pointer}
  .prev{left:8px}.next{right:8px}
  .fav{position:absolute;right:10px;top:10px;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.25);border-radius:999px;padding:6px 9px;cursor:pointer}
  .fav.active{background:#ff2e63;border-color:#ff2e63}
  .badge{position:absolute;left:10px;top:10px;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.25);color:#fff;padding:4px 8px;border-radius:999px;font-size:12px}
  .body{padding:14px}
  .title{margin:0 0 6px;font-size:16px;font-weight:800}
  .meta{font-size:13px;color:var(--muted)}
  .price{margin:10px 0;font-size:18px;color:var(--accent);font-weight:800}
  .old{color:var(--muted);text-decoration:line-through;margin-left:8px;font-weight:600}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .btn{display:inline-flex;align-items:center;gap:6px;padding:10px 12px;border-radius:10px;text-decoration:none;font-weight:700;border:1px solid transparent;white-space:nowrap}
  .btn-wa{background:#25D366;color:#042410}
  .btn-fb{background:var(--btn2);color:#fff}
  .btn-amz{background:var(--btn3);color:#fff}
  .muted{opacity:.75}
  .empty{padding:20px;text-align:center;color:var(--muted)}
</style>
</head>
<body>
<header>
  <div class="brand">
    <h1>Warehouse Terminator Deals</h1>
    <span class="muted">Live from Google Sheets ‚Üí WhatsApp</span>
  </div>
  <div class="tools">
    <button id="theme" class="switch" title="Toggle theme">üåô / ‚òÄÔ∏è</button>
  </div>
</header>

<div class="wrap">
  <div class="filters">
    <input id="q" type="search" placeholder="Search by title, details, category‚Ä¶" />
    <select id="cat"><option value="">All categories</option></select>
    <select id="stock">
      <option value="">All items</option>
      <option value="yes">In stock</option>
      <option value="no">Out of stock</option>
    </select>
    <select id="sort">
      <option value="">Sort: Default</option>
      <option value="price-asc">Price ‚Üë</option>
      <option value="price-desc">Price ‚Üì</option>
      <option value="title-asc">Title A‚ÜíZ</option>
      <option value="title-desc">Title Z‚ÜíA</option>
      <option value="fav">Favourites</option>
    </select>
  </div>

  <div id="grid" class="grid"></div>
  <p id="empty" class="empty" style="display:none">Nothing found.</p>
</div>

<script>
/* === CONFIG === */
const SHEET_ID = '1KzTz3QsWVZeVuxtE7Jw0uAaqMBvvdQHT_Wuuv1zeWZk'; // —Ç–≤–æ–π ID ‚Äî –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
const SHEET_NAME = 'Products';
const GVIZ = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;
const WHATSAPP = '13653784497'; // —Ç–≤–æ–π –Ω–æ–º–µ—Ä –±–µ–∑ –ø–ª—é—Å–∞

/* === STATE === */
let ITEMS = [];
let FAVS = new Set(JSON.parse(localStorage.getItem('wt_favs')||'[]'));

/* === THEME === */
const root = document.documentElement;
const themeBtn = document.getElementById('theme');
(function initTheme(){
  const t = localStorage.getItem('wt_theme') || 'dark';
  root.setAttribute('data-theme', t);
})();
themeBtn.addEventListener('click', ()=>{
  const t = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
  root.setAttribute('data-theme', t);
  localStorage.setItem('wt_theme', t);
});

/* === HELPERS === */
const $ = s => document.querySelector(s);
function money(v){
  if(v==null || v==='') return '';
  const n = Number(v);
  return isFinite(n) ? `$${n.toFixed(n%1?2:0)}` : `$${v}`;
}
function normRow(r){
  const o = {};
  for(const k in r) o[k.trim().toLowerCase()] = r[k];
  return {
    title: o.title || '',
    price_now: o.price_now || '',
    price_old: o.price_old || '',
    category: o.category || '',
    image: o.image || '',
    details: o.details || '',
    fb_url: o.fb_url || '',
    in_stock: (o.in_stock||'yes').toString().toLowerCase()
  };
}
function buildWA(item){
  const msg = `Hi! I'm interested in "${item.title}" for ${money(item.price_now)}${item.fb_url?` ‚Äî ${item.fb_url}`:''}`;
  return `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`;
}
function parseGviz(text){
  const json = text.replace(/^[\s\S]*setResponse\(/,'').replace(/\);?\s*$/,'');
  return JSON.parse(json);
}

/* === LOAD === */
async function load(){
  try{
    const res = await fetch(GVIZ, {cache:'no-store'});
    const text = await res.text();
    const g = parseGviz(text);
    const cols = g.table.cols.map(c=>c.label||c.id);
    const rows = g.table.rows.map(r=>{
      const obj = {};
      r.c.forEach((cell,i)=>obj[cols[i]] = cell ? cell.v : '');
      return obj;
    });
    ITEMS = rows.map(normRow);
    fillCategories();
    render();
  }catch(e){
    console.error(e);
    $('#empty').style.display='';
    $('#empty').textContent='Failed to load products.';
  }
}

/* === RENDER === */
function imagesOf(item){
  // –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Å—ã–ª–æ–∫ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é ‚Üí –º–∞—Å—Å–∏–≤
  return String(item.image||'').split(',').map(s=>s.trim()).filter(Boolean);
}
function card(item, idx){
  const imgs = imagesOf(item);
  const hasGallery = imgs.length > 1;
  // price_old: —Å—Å—ã–ª–∫–∞ ‚Üí –∫–Ω–æ–ø–∫–∞ Amazon, –∏–Ω–∞—á–µ –∑–∞—á—ë—Ä–∫–Ω—É—Ç–∞—è —Ü–µ–Ω–∞
  let old = '';
  if(item.price_old){
    const val = String(item.price_old).trim();
    if(val.startsWith('http')){
      old = `<a href="${val}" target="_blank" rel="noopener nofollow" class="btn btn-amz">üîç Compare on Amazon</a>`;
    }else{
      old = `<span class="old">${money(val)}</span>`;
    }
  }
  const id = `card-${idx}`;
  const favActive = FAVS.has(item.title) ? 'active' : '';
  const badge = item.category ? `<span class="badge">${item.category}</span>` : '';
  return `
    <article class="card" data-title="${item.title.toLowerCase()}" data-cat="${item.category}" data-stock="${item.in_stock}">
      <div class="media" data-idx="${idx}" data-i="0">
        ${badge}
        <button class="fav ${favActive}" title="Add to favourites" onclick="toggleFav('${encodeURIComponent(item.title)}', this)">‚ù§</button>
        <img loading="lazy" src="${imgs[0]||''}" alt="${item.title}">
        ${hasGallery?`<button class="navbtn prev" onclick="navImg(${idx},-1)">‚óÄ</button>
                      <button class="navbtn next" onclick="navImg(${idx},1)">‚ñ∂</button>`:''}
      </div>
      <div class="body">
        <h3 class="title">${item.title}</h3>
        <div class="meta">${item.details||''}</div>
        <div class="price">${money(item.price_now)} ${old}</div>
        <div class="row">
          <a class="btn btn-wa" href="${buildWA(item)}" target="_blank" rel="noopener">Message on WhatsApp</a>
          ${item.fb_url?`<a class="btn btn-fb" href="${item.fb_url}" target="_blank" rel="noopener">View on Facebook</a>`:''}
        </div>
      </div>
    </article>
  `;
}
function render(){
  const q = $('#q').value.toLowerCase().trim();
  const cat = $('#cat').value;
  const stock = $('#stock').value;
  const sort = $('#sort').value;

  let list = ITEMS.slice();

  // Filter
  list = list.filter(x=>{
    if (stock && x.in_stock!==stock) return false;
    if (cat && x.category !== cat) return false;
    if (q && !(x.title.toLowerCase().includes(q) || (x.details||'').toLowerCase().includes(q) || (x.category||'').toLowerCase().includes(q))) return false;
    if (sort==='fav' && !FAVS.has(x.title)) return false;
    return true;
  });

  // Sort
  if (sort==='price-asc') list.sort((a,b)=>(Number(a.price_now)||1e15)-(Number(b.price_now)||1e15));
  if (sort==='price-desc') list.sort((a,b)=>(Number(b.price_now)||-1e15)-(Number(a.price_now)||-1e15));
  if (sort==='title-asc') list.sort((a,b)=>String(a.title).localeCompare(String(b.title)));
  if (sort==='title-desc') list.sort((a,b)=>String(b.title).localeCompare(String(a.title)));

  const grid = $('#grid');
  grid.innerHTML = list
    .filter(x=>x.in_stock!=='no') // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã–≤–∞–µ–º sold; –ø–æ–∫–∞–∂–µ–º, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ, —á–µ—Ä–µ–∑ —Ñ–∏–ª—å—Ç—Ä "Out of stock"
    .map((item,i)=>card(item,i))
    .join('');

  $('#empty').style.display = list.length ? 'none' : '';
}

/* === GALLERY NAV === */
function navImg(idx, dir){
  const card = document.querySelector(`.media[data-idx="${idx}"]`);
  if(!card) return;
  const i = Number(card.getAttribute('data-i')||0);
  const imgs = imagesOf(ITEMS[idx]);
  const next = (i + dir + imgs.length) % imgs.length;
  card.setAttribute('data-i', String(next));
  const img = card.querySelector('img');
  img.src = imgs[next] || '';
}

/* === FAVOURITES === */
function toggleFav(titleEncoded, btn){
  const title = decodeURIComponent(titleEncoded);
  if(FAVS.has(title)) { FAVS.delete(title); btn.classList.remove('active'); }
  else { FAVS.add(title); btn.classList.add('active'); }
  localStorage.setItem('wt_favs', JSON.stringify([...FAVS]));
}

/* === CATEGORIES === */
function fillCategories(){
  const set = new Set(ITEMS.map(i=>i.category).filter(Boolean));
  const sel = $('#cat');
  const now = sel.value;
  sel.innerHTML = `<option value="">All categories</option>` + [...set].sort().map(c=>`<option>${c}</option>`).join('');
  if ([...set].includes(now)) sel.value = now;
}

/* === EVENTS === */
$('#q').addEventListener('input', render);
$('#cat').addEventListener('change', render);
$('#stock').addEventListener('change', render);
$('#sort').addEventListener('change', render);

/* === START === */
load();
</script>
</body>
</html>
